<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Sneaker Shop</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<style>
    .boton-imagen {
        background-image: url(imagenes/login.png);
        background-repeat: no-repeat;
        background-color: transparent;
        background-size: 30px 30px;
        background-position: center;
        width: 30px;
        height: 30px;
    }

    #carousel img {
        height: 500px;
        object-fit: contain;
    }

    .marcas h3 {
        text-align: center;
        margin-top: 30px;
    }

    .container h2 {
        text-align: center;
        margin-bottom: 10px;
    }

    .container {
        margin-top: 20px;
    }

    #derechos {
        text-align: center;
    }
    

</style>

<body class="bg-light">
    <div id="header"></div>

    <!--Aqui esta el funcionamineto del carrusel-->
    <div id="carousel" class="carousel slide" data-bs-ride="carousel" data-bs-touch="true">
        <div class="carousel-inner">
            <div class="carousel-item active" data-bs-interval="5000">
                <img src="imagenes/images.jpg" class="d-block w-100" alt=".." />
            </div>
            <div class="carousel-item" data-bs-interval="5000">
                <img src="imagenes/descargar.jpg" class="d-block w-100" alt=".." />
            </div>
            <div class="carousel-item" data-bs-interval="5000">
                <img src="imagenes/snkrs-showcase-product-unveil-recap.avif" class="d-block w-100" alt="" />
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
        </button>
    </div>
    <!-- productos destacados de la tienda -->
    <div class="container">
        <h2>Productos Destacados</h2>
        <p class="text-center">¡Aqui verás nuestros productos mas importantes!</p>
        <div id="destacados" class="row justify-content-center"></div>
    </div>

    <!-- Ofertas especiales de la tienda -->
    <div class="container">
        <h2>Ofertas Especiales</h2>
        <p class="text-center">¡No te pierdas nuestras mejores ofertas!</p>
        <div id="especiales" class="row justify-content-center"></div>
    </div>

    <!-- Marcas que tiene la tienda -->
    <div class="container">
        <h2>Marcas</h2>
        <p class="text-center">¡Estas son las marcas que tenemos en la tienda!</p>
        <div id="marcas" class="row justify-content-center"></div>
    </div>

    <div id="footer"></div>

    <script>
        /*Este es el fecth que muestra los productos destacados*/
        async function cargarDestacados() {
            try {
                const res = await fetch("http://localhost:8080/api/products/featured");
                const productos = await res.json();

                const contenedor = document.getElementById("destacados");
                contenedor.innerHTML = "";

                for (let p of productos.slice(0, 6)) {

                    const imagenRes = await fetch(`http://localhost:8080/api/products/${p.id}/images`);
                    const imagenes = await imagenRes.json();

                    const imageUrl = imagenes.length > 0
                        ? imagenes[0].imageUrl
                        : "imagenes/default.png";

                    const card = `
                <div class="col-12 col-md-3 mb-3">
                    <div class="card h-100" onclick="verProducto(${p.id})" style="cursor:pointer;>
                        <img src="${imageUrl}" class="card-img-top" alt="${p.name}">
                        <div class="card-body text-center">
                            <h5 class="card-title">${p.name}</h5>
                            <p class="card-text">${p.price} €</p>
                            <button class="btn btn-primary">Añadir</button>
                        </div>
                    </div>
                </div>
            `;
                    contenedor.innerHTML += card;
                }

            } catch (e) {
                console.error(" Error al conectar con la API:", e);
            }
        }


        /*Este es el fect de cargar los productos especiales que tiene la tienda*/
        async function cargarEspeciales() {
            try {
                const res = await fetch("http://localhost:8080/api/products/on-sale");
                const productos = await res.json();
                const contenedor = document.getElementById("especiales");

                contenedor.innerHTML = "";

                for (let producto of productos.slice(0, 6)) {
                    const imagenRes = await fetch(`http://localhost:8080/api/products/${producto.id}/images`);
                    const imagenes = await imagenRes.json();

                    const imageUrl = imagenes.length > 0
                        ? imagenes[0].imageUrl
                        : "imagenes/default.png";

                    contenedor.innerHTML += `
                <div class="col-12 col-md-3 mb-3">
                    <div class="card h-100" onclick="verProducto(${producto.id})" style="cursor:pointer;>
                        <img src="${imageUrl}" class="card-img-top">
                        <div class="card-body text-center">
                            <h5 class="card-title">${producto.name}</h5>
                            <p class="text-muted"><s>${producto.price} €</s></p>
                            <p class="text-danger">${producto.discountPrice} €</p>
                            <button class="btn btn-primary">Añadir</button>
                        </div>
                    </div>
                </div>
            `;
                }
            } catch (error) {
                console.error("Error cargando ofertas:", error);
            }
        }

        // El fecth de cargar las marcas
        async function cargarMarcas() {
            try {
                const res = await fetch("http://localhost:8080/api/brands");
                const marcas = await res.json();
                const contenedor = document.getElementById("marcas");

                contenedor.innerHTML = "";

                for (let marca of marcas) {
                    contenedor.innerHTML += `
                <div class="col-12 col-md-3 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">${marca.name}</h5>
                        </div>
                    </div>
                </div>
            `;
                }
            } catch (error) {
                console.error("Error cargando marcas:", error);
            }
        }

        // Helper para cargar un fragmento HTML en un elemento por id
        async function loadFragment(url, targetId) {
            try {
                const res = await fetch(url, { cache: "no-cache" });
                if (!res.ok) throw new Error(res.status + " " + res.statusText);
                const html = await res.text();
                const el = document.getElementById(targetId);
                if (el) el.innerHTML = html;
                else console.warn("Elemento no encontrado:", targetId);
            } catch (err) {
                console.error("Error cargando", url, err);
            }
        }
         function verProducto(id){
            window.location.href = `infoProducto.html?id=${id}`;
        }



        // Cargar header y footer
        loadFragment("header.html", "header");
        loadFragment("footer.html", "footer");
        window.onload = () => {
            cargarDestacados();
            cargarEspeciales();
            cargarMarcas();
        };
    </script>
</body>

</html>